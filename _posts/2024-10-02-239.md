---
categories:
- ê¸°íƒ€
- ì´ëª¨ì €ëª¨
date: 2024-10-02 22:23:03 +0900
math: true
tags:
- ai
- api
- bing
- chatgpt
- email
- news
- openai
- slack
title: ìµœê·¼ ë‰´ìŠ¤ ê²€ìƒ‰, ìš”ì•½ ìë™í™” í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸°
uid: 239
---

## ê°œìš”

ìµœê·¼ì— ìŸì•„ì§€ëŠ” ë‰´ìŠ¤ì™€ ì •ë³´ ì†ì—ì„œ ë‚´ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ëŠ”ê²Œ ì‰½ì§€ ì•Šë‹¤. ë‚´ê°€ ì›í•˜ëŠ” ë‚´ìš©ë“¤ì„ ë§¤ë²ˆ ê²€ìƒ‰í•´ì•¼ í•˜ê³  ê²€ìƒ‰í•œ ë‚´ìš©ìœ¼ë¡œë¶€í„° ë‚˜í•œí…Œ ì˜ë¯¸ê°€ ìˆëŠ” ìë£Œë“¤ì¸ì§€ ë¹ ë¥´ê²Œ ì½ì–´ë³´ê³  ì¶”ë¦¬ê³  ìš”ì•½í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

í•˜ì§€ë§Œ ì´ê±¸ ìë™í™”í•˜ë©´ ì–´ë–¨ê¹Œ? ì§„ì§œ í•„ìš”í•œ ë‚´ìš©ë“¤ë§Œ ìš”ì•½í•´ì„œ ë‚˜ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆìœ¼ë©´ ë„ˆë¬´ë‚˜ í¸í•  ê²ƒ ê°™ë‹¤. ìš”ìƒˆ ë‹¤ì–‘í•œ LLM ëª¨ë¸ì´ ë‚˜ì˜¤ë©´ì„œ ì´ì •ë„ì˜ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ”ê²Œ ì–´ë µì§€ ì•Šë‹¤. ì‹¬ì§€ì–´ ìµœê·¼ì— ì—¬ëŸ¬ APIì™€ ChatGPTë¡œ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ê²ƒì„ ë³´ê³  ë‚˜ë„ ìœ ì‚¬í•˜ê²Œ ë§Œë“¤ì–´ë´¤ë‹¤.

ë‚´ê°€ ì›í•˜ëŠ” í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ê³  ì›í•˜ëŠ”ëŒ€ë¡œ í•„í„°ë§í•˜ê³  ìš”ì•½ ì •ë¦¬ í•´ì£¼ëŠ” Bot! ğŸ¤–

*ì˜ˆì‹œ Slack ì•Œë¦¼ ë©”ì‹œì§€*

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-30 á„‹á…©á„’á…® 6.27.39.png](https://i.imgur.com/U6zvqIe.png)

## ìš”êµ¬ì‚¬í•­

- ëª©ì 
    - íŠ¹ì • ê´€ì‹¬ì‚¬ì˜ í‚¤ì›Œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìµœì‹  ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì£¼ê¸°ì ìœ¼ë¡œ í•µì‹¬ ë‚´ìš© íŒŒì•…
- ê¸°ëŠ¥
    - ì£¼ìš” ê¸°ì‚¬ì˜ ì œëª©, ë‚ ì§œ, ì›ë¬¸, ì¶œì²˜ ë“± íŒŒì•…
    - ì¤‘ë³µë˜ê±°ë‚˜ ê´€ì‹¬ì‚¬ê°€ ì•„ë‹Œ ë‰´ìŠ¤ ì œê±°
    - ìš”ì•½, ì •ë¦¬ëœ ë‚´ìš©ë“¤ì„ ë©”ì¼ì´ë‚˜ Slack ë“±ìœ¼ë¡œ ì „ì†¡
    - gpt-4o-mini ë“± ìµœëŒ€í•œì˜ ì €ë¹„ìš©ìœ¼ë¡œ êµ¬í˜„

## ì „ì²´êµ¬ì¡°

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-30 á„‹á…©á„’á…® 6.34.26.png](https://i.imgur.com/fl3KKoM.png)

1. Bing APIë¡œ ë‰´ìŠ¤ ê²€ìƒ‰
    - ì§€ì •ëœ í•œê¸€, ì˜ì–´ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ëœ ë‚´ìš©ë“¤ì„ ì‚¬ìš©
2. ChatGPT APIë¡œ ì·¨í•©, ìš”ì•½, ì •ë¦¬
    - Bing ê²€ìƒ‰ ê²°ê³¼ë¥¼ íŠ¹ë³„í•œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  í”„ë¡¬í”„íŠ¸ì™€ í•¨ê»˜ ì •ë¦¬ ìš”ì²­
    - í”„ë¡¬í”„íŠ¸ë¥¼ í†µí•´ ì›í•˜ëŠ” pydanticì˜ í¬ë§·ìœ¼ë¡œ ì¶œë ¥ì„ ë°›ì•„ì˜´ (ì œëª©, ë‚ ì§œ, ìš”ì•½ ë“±)
3. ì£¼ê¸°ì  ì‹¤í–‰
    - Google Cloud Function, Google Cloud Schedulerë¥¼ í†µí•´ Serverless í˜•íƒœë¡œ ì£¼ê¸°ì  ì‹¤í–‰ (ë§¤ì£¼ ì›”ìš”ì¼ 10ì‹œì— ì— ë™ì‘)

## Bing API ì‚¬ìš©í•˜ê¸°

### Azure ì‹œì‘

Bing News APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ Microsoftì˜ [Azure ì„œë¹„ìŠ¤](https://www.google.com/aclk?sa=l&ai=DChcSEwjS4cGUuO6IAxXC1RYFHZmLPPMYABAAGgJ0bA&co=1&ase=2&gclid=Cj0KCQjwu-63BhC9ARIsAMMTLXSb9Tl72aEClDwhJUHU2Ype6U1OoDxGWcPTwl70U5TaPZCH-SGQK24aAnvKEALw_wcB&sig=AOD64_2xsy_D_PueX6KH32aS1cTm0zc2PA&q&nis=4&adurl&ved=2ahUKEwirqr6UuO6IAxUwzjQHHRGhMcMQ0Qx6BAgIEAE)ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ì²˜ìŒ Azureë¥¼ ì‹œì‘í•œë‹¤ë©´ ê³„ì •ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ê°€ì… í• ë•Œ ê°œì¸ ì¹´ë“œ ì •ë³´ê°€ í•„ìš”í• í…ë° ë¹„ìš©ì´ ë°œìƒí• ë•Œ ì´ ì¹´ë“œë¡œ ìš”ê¸ˆì´ ë¶€ê³¼ëœë‹¤. ì´ë•Œ ì²« ê°€ì…ì´ë¼ë©´ 12ê°œì›” 200$ í¬ë ˆë”§ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-19 á„‹á…©á„’á…® 1.15.59.png](https://i.imgur.com/Gg81Zg5.png)

### Bing Search API

Azureì— ê°€ì…í•˜ê³  ê³„ì •ì„ ë“±ë¡í–ˆë‹¤ë©´ [Bing Search API](https://www.microsoft.com/en-us/bing/apis)ì— ì ‘ì†í•´ë³¸ë‹¤. ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì²˜ëŸ¼ Bing Search ì„œë¹„ìŠ¤ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•œë‹¤.(Web, Image, News, Video ë“±ë“±) ì•„ë˜ ì„œë¹„ìŠ¤ë“¤ ì¤‘ News Search APIë¥¼ í†µí•´ ìµœì‹  ë‰´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-19 á„‹á…©á„’á…® 1.12.39.png](https://i.imgur.com/paVvB2N.png)

Bing News Search API í˜ì´ì§€ì— ë“¤ì–´ê°€ Try Now ë¥¼ í´ë¦­í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ ê²€ìƒ‰ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“œëŠ” ì°½ì´ ëœ¬ë‹¤. ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ê³¼ ì´ë¦„ì€ ì ë‹¹í•˜ê²Œ ë§Œë“¤ì–´ì„œ ì…ë ¥í•´ì£¼ê³ , ê°€ê²© ì±…ì • ê³„ì¸µì€ ë§ì€ ìš”ê¸ˆì´ ë¶€ê³¼ë˜ì§€ ì•Šê²Œ ê°€ì¥ ìµœìƒë‹¨ì— ìˆëŠ” ê²ƒì„ ì„ íƒí•´ ì¤€ë‹¤. ì„¤ëª…ì— ë³´ì´ëŠ” ê²ƒì²˜ëŸ¼ 1ì´ˆì— 3ë²ˆ, 1ë‹¬ì— 1ì²œë²ˆ ì œí•œì´ ìˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-10-02 á„‹á…©á„Œá…¥á†« 9.26.02.png](https://i.imgur.com/a0vUxzi.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-10-02 á„‹á…©á„Œá…¥á†« 9.32.09.png](https://i.imgur.com/aq8asM7.png)

> ê°€ê²© ì±…ì • ê³„ì¸µ ì„ íƒ í•­ëª© ì¤‘ F1ì€ ë¬´ë£Œ ìš”ê¸ˆì œì´ë©° ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://www.microsoft.com/en-us/bing/apis/pricing)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
{: .prompt-tip }


### API KEY ë°œê¸‰

ì´ì œ ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ì†í•˜ì—¬ í‚¤ë¥¼ ë°œê¸‰ë°›ëŠ”ë‹¤. click here to manage keysë¥¼ ëˆ„ë¥´ë©´ ìƒˆë¡œìš´ í‚¤ë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ í‚¤ëŠ” ì²« ìƒì„±ì‹œì—ë§Œ ë³´ì´ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì €ì¥ì´ë‚˜ ë³´ê´€ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤. (ìœ ì¶œ X)

![image.png](https://i.imgur.com/e8dCws1.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-19 á„‹á…©á„’á…® 1.36.28.png](https://i.imgur.com/4Vuz4dm.png)

### ê³µì‹ ë¬¸ì„œ í™•ì¸

ì•„ë˜ ë§í¬ëŠ” ê³µì‹ Documentì´ë‹¤. í•´ë‹¹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ë‚˜ëŠ” python ê¸°ë°˜ new search í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì—ˆë‹¤.

https://learn.microsoft.com/ko-kr/bing/search-apis/bing-news-search/quickstarts/quickstarts

### íŒ¨í‚¤ì§€ ì„¤ì¹˜

ì•„ë˜ ëª…ë ¹ì–´ë¡œ bing news search client ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•œë‹¤.

```bash
pip install azure-cognitiveservices-search-newssearch
```

### ìƒ˜í”Œ ì½”ë“œ

ì•„ë˜ì˜ `subscription_key`, `endpoint`, `search_term` ì„ ë³¸ì¸ì˜ ìƒí™©ì— ë§ê²Œ ì‹¤í–‰í•˜ë©´ ì›í•˜ëŠ” í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ì—¬ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤. (ì˜ˆì‹œëŠ” ì˜ì–´ í‚¤ì›Œë“œì™€ ì˜ì–´ ë‰´ìŠ¤ë¡œ 10ê°œì˜ ë‰´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë˜ì–´ìˆë‹¤.)

```python
from azure.cognitiveservices.search.newssearch import NewsSearchClient
from msrest.authentication import CognitiveServicesCredentials
subscription_key = "YOUR-SUBSCRIPTION-KEY"
endpoint = "YOUR-ENDPOINT"
search_term = "Quantum Computing"

# create client instance
client = NewsSearchClient(endpoint=endpoint, credentials=CognitiveServicesCredentials(subscription_key))

# send search quary, and then store the response
news_result = client.news.search(query=search_term, market="en-us", count=10)

# parse the response
if news_result.value:
    first_news_result = news_result.value[0]
    print("Total estimated matches value: {}".format(
        news_result.total_estimated_matches))
    print("News result count: {}".format(len(news_result.value)))
    print("First news name: {}".format(first_news_result.name))
    print("First news url: {}".format(first_news_result.url))
    print("First news description: {}".format(first_news_result.description))
    print("First published time: {}".format(first_news_result.date_published))
    print("First news provider: {}".format(first_news_result.provider[0].name))
else:
    print("Didn't see any news result data..")
```

ìœ„ì˜ ì½”ë“œ ì¤‘ parse the response ë¶€ë¶„ì„ ë³´ë©´ ì•„ë˜ì˜ í•­ëª©ë“¤ì„ ê°ê° í™•ì¸í•  ìˆ˜ ìˆë‹¤.

1. total_estimated_mateches: í•´ë‹¹ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•œ ì „ì²´ ë‰´ìŠ¤ ê°œìˆ˜
2. name: ë‰´ìŠ¤ ì œëª©
3. url: ë‰´ìŠ¤ ë§í¬ URL
4. description: ë‰´ìŠ¤ì— ëŒ€í•œ ì„¤ëª…
5. date_published: ë‰´ìŠ¤ ë‚ ì§œ
6. provider: ë‰´ìŠ¤ì˜ ì¶œì²˜

ì´ ì •ë„ë©´ ê° ë‰´ìŠ¤ë¡œë¶€í„° ì›í•˜ëŠ” ë‚´ìš©ì€ ê±°ì˜ ëŒ€ë¶€ë¶„ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.

## Langchain ìœ¼ë¡œ ìš”ì•½, ì •ë¦¬í•˜ê¸°

ìœ„ì—ì„œ BingAPIë¡œ news ë‚´ìš©ë“¤ì„ ëª¨ë‘ ê°€ì ¸ì™”ë‹¤ë©´ ì´ì œ ë‚´ê°€ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì²˜ë¦¬ë¥¼ í•´ì•¼ í•œë‹¤. ì´ëŠ” rule-baseê°€ ì•„ë‹Œ chatgptì˜ apië¥¼ ì‚¬ìš©í•´ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ì²˜ë¦¬í•˜ë„ë¡ í–ˆë‹¤.

### í”„ë¡¬í”„íŠ¸ ì‘ì„±

ì´ë•Œì˜ ì‘ì„±í•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì–´ë–»ê²Œ ì“°ëŠëƒì— ë”°ë¼ ê²°ê³¼ë¬¼ í’ˆì§ˆì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìµœëŒ€í•œ ìì‹ ì˜ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ë§ì¶°ì„œ ì‘ì„±í•´ì•¼ í•œë‹¤.

```python
from langchain_core.prompts import PromptTemplate

template = """
ë‹¹ì‹ ì€ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ êµ¬ì¡°í™”ëœ í˜•ì‹ìœ¼ë¡œ ìš”ì•½í•˜ì—¬ ì œê³µí•´ì£¼ëŠ” assistant ì´ë‹¤. 

ë‹¤ìŒì˜ News ìë£Œë“¤ì„ title, date, summary, source, link ë¡œ êµ¬ë¶„í•˜ì—¬ í•œê¸€ë¡œ ë‚´ìš©ì„ ì •ë¦¬í•´ì¤˜. 
ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ ê°„ì— ì¤‘ë³µë˜ëŠ” ë‚´ìš©ì´ ìˆë‹¤ë©´ í•˜ë‚˜ë§Œ ì¶”ë ¤ì„œ ì œê³µí•´ì¤˜.
ë‚ ì§œëŠ” í•œêµ­ì‹œê°„(YYYY-MM-DD)ìœ¼ë¡œ í•´ì£¼ê³ , ìš”ì•½ ë‚´ìš©ì€ 1~2ì¤„ì˜ ê°„ê²°í•œ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•´ì¤˜. 

News: {news}
"""
prompt = PromptTemplate(template=template)
```

### Pydantic Parserë¡œ ì¶œë ¥

ì´ì œ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•˜ê¸° ìœ„í•´ì„œ Pydantic ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•´ì¤€ë‹¤. titleì„ ì‘ì„±í•˜ë©´ chatgpt apië¥¼ ìš”ì²­í• ë•Œ í•´ë‹¹ í˜•ì‹ì— ë§ê²Œ ì¶œë ¥í•˜ë¼ëŠ” promptê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‘í•˜ê²Œ ëœë‹¤.

ë‰´ìŠ¤ ê¸°ì‚¬ê°€ ì—¬ëŸ¬ê°œì´ê¸° ë•Œë¬¸ì— ListOfNewsë¼ëŠ” ëª¨ë¸ í´ë˜ìŠ¤ë„ ì¶”ê°€ë¡œ ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤.

```python
class News(BaseModel):
    title: str = Field(..., title="ë‰´ìŠ¤ ì œëª©")
    date: str = Field(..., title="ë‰´ìŠ¤ ë°œí–‰ì¼")
    summary: str = Field(..., title="ë‰´ìŠ¤ ìš”ì•½")
    source: str = Field(..., title="ë‰´ìŠ¤ ì¶œì²˜")
    link: str = Field(..., title="ë‰´ìŠ¤ ë§í¬")

class ListOfNews(BaseModel):
    news: List[News]
```

### chain ì‚¬ìš©

ì´ì œ ChatOpenAI ëª¨ë¸ì„ ì •ì˜í•˜ê³  apië¥¼ ìš”ì²­í•  ìˆ˜ ìˆê²Œ chainì„ êµ¬ì„±í•©ë‹ˆë‹¤. ì´ë•Œ modelì€ ê°€ì¥ ìµœê·¼ì— ì €ë ´í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” gpt-4o-minië¥¼ ì‚¬ìš©í–ˆê³ , `llm.with_structured_output(ListOfNews)` ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ apiì˜ ì¶œë ¥ ìì²´ê°€ pydantic í´ë˜ìŠ¤ê°€ ë˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

```python
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model_name="gpt-4o-mini")
chain = prompt | llm.with_structured_output(ListOfNews)
resp = chain.invoke(news)
```

*ìƒì„±í˜•AI í‚¤ì›Œë“œë¡œ ìš”ì²­í•œ ì˜ˆì‹œ ì¶œë ¥*

```python
ListOfNews(
	news=[
		News(title="AIì™€ ëŒ€í™”í•˜ë©° ì•± ì œì‘â€¦ì˜¤í”ˆAI, 'ì‹¤ì‹œê°„ API' ë² íƒ€ ê³µê°œ", date='2024-10-02', summary='ì˜¤í”ˆAIê°€ ì¸ê³µì§€ëŠ¥ê³¼ ëŒ€í™”í•˜ë©° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•  ìˆ˜ ìˆëŠ” ì‹¤ì‹œê°„ APIì˜ ë² íƒ€ë²„ì „ì„ ê³µê°œí–ˆë‹¤.', source='zdnet', link='https://zdnet.co.kr/view/?no=20241002094548'), 
		News(title='ë³€ê³¡ì ì— ë†“ì¸ ê¸€ë¡œë²Œ ê²Œì„ ì‚°ì—…...ìƒì„±í˜•AIë¡œ ëŒíŒŒêµ¬ ì°¾ì€ ì¸ë””ê²Œì„ì‚¬', date='2024-10-02', summary='ê¸€ë¡œë²Œ ê²Œì„ ì‚°ì—…ì´ ê²½ê¸° ë‘”í™”ì™€ ê·œì œ ê°•í™”ë¡œ ì–´ë ¤ì›€ì„ ê²ªê³  ìˆìœ¼ë©°, ì¸ë””ê²Œì„ì‚¬ë“¤ì´ ìƒì„±í˜• AIë¥¼ í†µí•´ ëŒíŒŒêµ¬ë¥¼ ëª¨ìƒ‰í•˜ê³  ìˆë‹¤.', source='MSN', link='https://www.msn.com/ko-kr/news/other/%EB%B3%80%EA%B3%A1%EC%A0%90%EC%97%90-%EB%86%93%EC%9D%B8-%EA%B8%80%EB%A1%9C%EB%B2%8C-%EA%B2%8C%EC%9E%84-%EC%82%B0%EC%97%85-%EC%83%9D%EC%84%B1%ED%98%95ai%EB%A1%9C-%EB%8F%8C%ED%8C%8C%EA%B5%AC-%EC%B0%BE%EC%9D%80-%EC%9D%B8%EB%94%94%EA%B2%8C%EC%9E%84%EC%82%AC/ar-AA1ryhTX'), 
		News(title='Microsoftì˜ AI Copilot, ì‹œê° ë° ìŒì„± ì¸ì‹ ê¸°ëŠ¥ ì¶”ê°€', date='2024-10-02', summary='Microsoftê°€ AI Copilotì˜ ê¸°ëŠ¥ì„ ê°œì„ í•˜ì—¬ ì‚¬ìš©ìì™€ì˜ ìƒí˜¸ì‘ìš© ë°©ì‹ì„ í˜ì‹ í•˜ê³  ìˆë‹¤.', source='MSN', link='https://www.msn.com/en-us/news/other/microsoft-s-ai-copilot-makeover-lets-it-see-and-speak/ar-AA1rxuWs'), News(title='Microsoft, ìƒˆë¡œìš´ Copilot ê¸°ëŠ¥ ëŒ€ê±° ë°œí‘œ', date='2024-10-02', summary='Microsoftê°€ Copilot ì±—ë´‡ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ AI ê²€ìƒ‰ ë° ìƒì„±ì  ì±„ìš°ê¸° ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤.', source='Lifehacker', link='https://lifehacker.com/tech/microsoft-just-dropped-a-bunch-of-new-copilot-features')
	]
)
```

## ì „ì²´ ì½”ë“œ

- ì•„ë˜ëŠ” Bing Search API, ChatGPT Summary ìš”ì²­, Slack ë©”ì‹œì§€ ì „ì†¡ì´ í¬í•¨ëœë‹¤.

```python
from azure.cognitiveservices.search.newssearch import NewsSearchClient
from pydantic import BaseModel, Field
from datetime import datetime
from langchain_core.prompts import PromptTemplate
from langchain_openai import ChatOpenAI
from msrest.authentication import CognitiveServicesCredentials
from dotenv import load_dotenv
import os
from typing import List

load_dotenv(override=True)
SUBSCRIPTION_KEY = os.getenv('BING_API_KEY')
ENDPOINT = os.getenv('BING_ENDPOINT')

def bing_news_search(query, market: str, count: int):
    """
    Bing news search
    :param query: ê²€ìƒ‰ì–´
    :param market: ê²€ìƒ‰í•  ì§€ì—­ e.g. "ko-KR", "en-us"
    :param count: ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜
    :return: ê²€ìƒ‰ ê²°ê³¼
    """
    client = NewsSearchClient(endpoint=ENDPOINT,
                              credentials=CognitiveServicesCredentials(SUBSCRIPTION_KEY))
    client.config.base_url = '{Endpoint}/v7.0'

    news_result = client.news.search(query=query,
                                     market=market,
                                     count=count,
                                     freshness='Day',
                                     sort_by='Date')
    return news_result

def parse_news_result(news):
    """
    Bing news search ê²°ê³¼ë¥¼ íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜
    :param news_result: Bing news search ê²°ê³¼
    :return: íŒŒì‹±ëœ ê²°ê³¼
    """
    parsed_news = {
        'name': news.name,
        'url': news.url,
        'description': news.description,
        'provider': news.provider[0].name,
        'date_published': news.date_published,
        'category': news.category,
        'image': news.image.thumbnail.content_url if news.image else None
    }
    return parsed_news

class News(BaseModel):
    title: str = Field(..., title="ë‰´ìŠ¤ ì œëª©")
    date: str = Field(..., title="ë‰´ìŠ¤ ë°œí–‰ì¼")
    summary: str = Field(..., title="ë‰´ìŠ¤ ìš”ì•½")
    source: str = Field(..., title="ë‰´ìŠ¤ ì¶œì²˜")
    link: str = Field(..., title="ë‰´ìŠ¤ ë§í¬")

class ListOfNews(BaseModel):
    news: List[News]

class NewsParameter(BaseModel):
    keyword: str  # ê²€ìƒ‰ì–´
    count: int  # ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜
    market: str  # ê²€ìƒ‰í•  ì§€ì—­ e.g. "ko-KR", "en-us"

def get_news_data(params: [NewsParameter]) -> List:
    # ê° íŒŒë¼ë¯¸í„°ì— ë”°ë¼ ë‰´ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê³  parsing
    news_results = []
    for param in params:
        result = bing_news_search(param.keyword, market=param.market, count=param.count)
        news_results.extend(result.value)

    parsed_news_result = [parse_news_result(news) for news in news_results]

    return parsed_news_result

def process(news: List) -> ListOfNews:
    # summary using chatgpt
    llm = ChatOpenAI(model_name="gpt-4o-mini")
    template = """
    ë‹¹ì‹ ì€ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ êµ¬ì¡°í™”ëœ í˜•ì‹ìœ¼ë¡œ ìš”ì•½í•˜ì—¬ ì œê³µí•´ì£¼ëŠ” assistantì…ë‹ˆë‹¤. 

    ë‹¤ìŒì˜ News ìë£Œë“¤ì„ title, date, summary, source, link ë¡œ êµ¬ë¶„í•˜ì—¬ í•œê¸€ë¡œ ë‚´ìš©ì„ ì •ë¦¬í•´ì¤˜. 
    ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ ê°„ì— ì¤‘ë³µë˜ëŠ” ë‚´ìš©ì´ ìˆë‹¤ë©´ í•˜ë‚˜ë§Œ ì¶”ë ¤ì„œ ì œê³µí•´ì¤˜.
    ë‚ ì§œëŠ” í•œêµ­ì‹œê°„(YYYY-MM-DD)ìœ¼ë¡œ í•´ì£¼ê³ , ìš”ì•½ ë‚´ìš©ì€ 1~2ì¤„ì˜ ê°„ê²°í•œ ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±í•´ì¤˜. 

    News: {data}
    """
    prompt = PromptTemplate(template=template)
    chain = prompt | llm.with_structured_output(ListOfNews)
    resp = chain.invoke(news)

    return resp

def send_alert(news_list: ListOfNews):
    """ Slack ë©”ì‹œì§€ í˜¹ì€ Email ë³´ë‚´ëŠ” ì½”ë“œ ìƒëµ """

def main(params: [NewsParameter]):
    # 1. ë‰´ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    raw_news = get_news_data(params)

    # 2. ë‰´ìŠ¤ í•„í„°ë§, ìš”ì•½ ë“± ì²˜ë¦¬í•˜ê¸° (openai API)
    processed_news = process(raw_news)

    # 3. ê²°ê³¼ë¬¼ ì•ŒëŒ ì „ì†¡
    send_alert(processed_news)

if __name__ == '__main__':
    p_ko = NewsParameter(keyword="ì´ë¯¸ì§€ ìƒì„±í˜• AI", count=2, market="ko-KR")
    p_en = NewsParameter(keyword="Image Generative AI", count=2, market="en-us")

    main(params=[p_ko, p_en])

```

## ì •ë¦¬

ì´ë ‡ê²Œ í•´ì„œ ìµœê·¼ ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ì„ ê²€ìƒ‰í•˜ê³ , ìš”ì•½í•˜ê³ , ì•Œë¦¼í•˜ëŠ” ì „ ê³¼ì •ì„ ì‚´í´ë´¤ë‹¤. Slackì´ë‚˜ Email ë³´ë‚´ëŠ” ì½”ë“œëŠ” ìì‹ ì˜ api keyë¥¼ í†µí•´ì„œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

ë˜í•œ ì´ ì½”ë“œë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë ¤ë©´ ë³¸ì¸ì˜ PCì—ì„œ `cron` ì„ í†µí•´ ë“±ë¡í•˜ê±°ë‚˜, í˜¹ì€ **GCP Scheduler**, **Functions** ë“±ì„ ì´ìš©í•´ì„œ Serverless í˜•íƒœë¡œ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¼ ì›í•˜ëŠ” ì£¼ê¸°ë‚˜ ë‚ ì§œë³„ë¡œ ìµœê·¼ì˜ ê¸°ì‚¬ë“¤ì„ ìš”ì•½í•´ì„œ ì•Œë ¤ì£¼ê²Œ ëœë‹¤.

ì§€ê¸ˆì€ Bing Searchì˜ News APIë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ ë³¸ì¸ë§Œì˜ crawlerë¥¼ ë§Œë“¤ì–´ ì–´ë– í•œ í˜•íƒœë¡œë“  ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤ë©´ chatgpt apië¥¼ í™œìš©í•´ì„œ ì´ë¥¼ ìš”ì•½ì •ë¦¬ í•  ìˆ˜ ìˆë‹¤. í™œìš©í•  ìˆ˜ ìˆëŠ” ë¶„ì•¼ê°€ ë„ˆë¬´ ë§ê¸° ë•Œë¬¸ì— ë³¸ì¸ì˜ ëª©ì ì— ë”°ë¼ ì‘ìš©í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

Uploaded by [N2C](https://github.com/jmjeon2/Notion2Chirpy)